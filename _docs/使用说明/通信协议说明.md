---
title: 通信协议说明
category: 使用说明
order: 2
---

## 请求相关

1. 连接服务器

   + 协议：WebSocket

   + URI：GET /game/{user_info}

   + 连接示例：

     	```
     	ExampleClient('ws://127.0.0.1:8000/game/{user_info}').connect()
     	```
   + Path参数说明
     
     + user_info 字段值为用户的用户名，将作为用户的游戏AI的标识。

2. 发送动作

   + 请求示例：

      ```
      JSON
       {
           'action': [[3, '3']],
           'type': 'Single',
           'rank': '3'
       }
      ```

   + 字段说明

       |  参数  |     类型     |      描述      | 是否必须 |
       | :----: | :----------: | :------------: | :------: |
       | action | 列表数据类型 |    所选卡牌    |    是    |
       |  type  |    字符串    |    所选牌型    |    是    |
       |  rank  |    字符串    | 所选牌型的点数 |    是    |

   + 字段值说明

     + |  参数  |                            可取值                            |
       | :----: | :----------------------------------------------------------: |
       | action |                        合法的卡牌组合                        |
       |  type  | Single, Pair, Trips, ThreePair, ThreeWithTwo, Straight, StraightFlush, Bomb, PASS，tribute, back |
       |  rank  |        A, 2, 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, JOKER         |

# 响应相关

### 响应示例-通知类型

```
json
{
    'type': 1, 
    'hand_cards': [[3, '2'], [2, '3'], [3, '4'], [2, '4'], [0, '6'], [1, '9'], 
                   [0, '9'], [1, '9'], [0, 'Q'], [2, 'K'], [3, 'A'], [0, 'JOKER']], 
    'index': 2, 
    'public': [
        {'rest': 17, 'play_area': []}, 
        {'rest': 18, 'play_area': []}, 
        {'rest': 12, 'play_area': [[0, '9'], [1, '9'], [1, '9'], [3, '4'], [2, '4']]}, 
        {'rest': 18, 'play_area': [[0, '7'], [2, '7'], [3, '7'], [0, 'J'], [0, 'J']]}
    ], 
    'current_player': 2,
    'current_stage': 2, 
    'self_rank': '5', 
    'opponent_rank': '4', 
    'current_rank': '5', 
    'action_list': None, 
    'action_performed': {
        'action': [[0, '9'], [1, '9'], [1, '9'], [3, '4'], [2, '4']], 
        'type': 'ThreeWithTwo', 
        'rank': '9'
    }, 
    'current_times': 1, 
    'training_times': 2
}
```

+ 字段数据结构及说明

|       字段       |        数据类型         |                             描述                             | 是否必须 |
| :--------------: | :---------------------: | :----------------------------------------------------------: | :------: |
|       type       | 整型，取值范围[0,1, 2]  | 0表示通知，算法无需做出动作选择；1为表示算法需要做出动作选择；2表示小局游戏结束，包含游戏结束信息 |    是    |
|    hand_cards    |      列表数据类型       |                          自己的手牌                          |    是    |
|      public      |      字典数据类型       | 场上的公共信息，包含各AI当前正在结算的牌型及各AI所剩余手牌数量 |    是    |
|  current_player  | 整型，取值范围[0,1,2,3] |                     当前出牌AI的座位次序                     |    是    |
|  current_stage   | 整型，取值范围[2, 5, 6] |       2表示游戏出牌阶段，5表示进贡阶段，6表示还贡阶段        |    是    |
|    self_rank     |         字符串          |                         己方当前等级                         |    是    |
|  opponent_rank   |         字符串          |                         对方当前等级                         |    是    |
|   action_list    |    字典数据类型/null    | 可选动作空间/合法动作空间；通知类型下action_list字段值为null（None） |    是    |
| action_performed |      字典数据类型       |              当前打出的牌型（即上家打出的牌型）              |    是    |
|  current_times   |          整型           |                         当前训练次数                         |    是    |
|  training_times  |          整型           |                          总训练次数                          |    是    |

重复字段不在赘述

### 响应示例-动作选择类型

```
json
{
    'type': 2, 
    'hand_cards': [[1, '2'], [0, '2'], [3, '3'], [0, '3'], [0, '3'], [1, '6'], 
                   [1, '8'], [1, '8'], [1, '10'], [2, '10'], [0, 'Q'], [3, 'Q'],
                   [0, 'A'], [0, 'A'], [3, '5'], [0, '5'], [0, 'JOKER']], 
    'index': 0, 
    'public': [
        {'rest': 17, 'play_area': []},
        {'rest': 18, 'play_area': []},
        {'rest': 7, 'play_area': [[0, '9'], [1, '9'], [1, '9'], [3, '4'], [2, '4']]}, 
        {'rest': 18, 'play_area': []}
    ], 
    'current_player': 0, 
    'current_stage': 2, 
    'self_rank': '5', 
    'opponent_rank': '4', 
    'current_rank': '5', 
    'action_list': {'PASS': {'PASS': [[[0, 'PASS']]]}}, 
    'action_performed': {
        'action': [[0, 'PASS']], 
        'type': 'PASS', 
        'rank': 'PASS'
    }, 
    'current_times': 1, 
    'training_times': 2
}
```

|    字段     |   数据类型   |                             描述                             | 是否必须 |
| :---------: | :----------: | :----------------------------------------------------------: | :------: |
| action_list | 字典数据类型 | 动作选择类型下action_list字段值表示为AI当前可选的合法动作集合 |    是    |

### 响应类型-小局游戏结束

```
JSON
{
    'type': 0, 
    'self_rank': '2', 
    'opponent_rank': '4', 
    'current_rank': '4', 
    'current_times': 1, 
    'training_times': 2, 
    'winners': [3, 0, 1, 2]
}
```

|  字段   |   数据类型   |           描述           |     是否必须      |
| :-----: | :----------: | :----------------------: | :---------------: |
| winners | 列表数据结构 | 优先出完牌的AI的座位次序 | 是，且长度始终为4 |
+ 请按照API文档进行编写，需要用表格的地方用表格，用代码块的地方用代码块。markdown所见即所得
---
title: 通信协议说明
category: 使用说明
order: 2
---

+ AI与平台之间通过JSON数据来传递游戏消息，以下为JSON数据的说明



#### 发送动作

2. 一个AI需要做的是：每当接收到平台发送来的JSON数据，回执需要进行的动作（即打出的牌）。此外，AI无法与其他AI进行通信，下面进行出牌动作的说明

   + 一个出牌动作的JSON示例如下

      ```json
       {
           'action': [[3, '3']],
           'type': 'Single',
           'rank': '3'
       }
      ```
      
+ 字段说明
   
    |  参数  |     类型     |      描述      | 是否必须 |
       | :----: | :----------: | :------------: | :------: |
       | action | 列表数据类型 |    所选动作    |    是    |
       |  type  |    字符串    |    所选牌型    |    是    |
       |  rank  |    字符串    | 所选牌型的点数 |    是    |
   
+ 字段值说明
   
  |  参数  |                            可取值                            |
     | :----: | :----------------------------------------------------------: |
     | action |                        合法的卡牌组合                        |
     |  type  | Single, Pair, Trips, ThreePair, ThreeWithTwo, Straight, StraightFlush, Bomb, PASS，tribute, back |
     |  rank  |     A, 2, 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K, JOKER, PASS      |
   
   
   
   

#### 解析消息

+ AI需要在解析平台所发来的JSON数据的基础上，进行游戏信息集的提取。
+ 整个游戏过程中，平台会发送3种不同的JSON数据，下面进行逐一说明

##### 通知类型

+ AI收到通知类型的消息不需要做出动作选择，该类型用于表示某方打出某牌型的通知消息以及进抗贡的消息

```json
{
    'type': 1, 
    'hand_cards': [[3, '2'], [2, '3'], [3, '4'], [2, '4'], [0, '6'], [1, '9'], 
                   [0, '9'], [1, '9'], [0, 'Q'], [2, 'K'], [3, 'A'], [0, 'JOKER']], 
    'index': 2, 
    'public': [
        {'rest': 17, 'play_area': []}, 
        {'rest': 18, 'play_area': []}, 
        {'rest': 12, 'play_area': [[0, '9'], [1, '9'], [1, '9'], [3, '4'], [2, '4']]}, 
        {'rest': 18, 'play_area': [[0, '7'], [2, '7'], [3, '7'], [0, 'J'], [0, 'J']]}
    ], 
    'current_player': 2,
    'current_stage': 2, 
    'self_rank': '5', 
    'opponent_rank': '4', 
    'current_rank': '5', 
    'action_list': None, 
    'action_performed': {
        'action': [[0, '9'], [1, '9'], [1, '9'], [3, '4'], [2, '4']], 
        'type': 'ThreeWithTwo', 
        'rank': '9'
    }, 
    'current_times': 1, 
    'training_times': 2
}
```

+ 字段数据结构及说明

|       字段       |        数据类型         |                             描述                             | 是否必须 |
| :--------------: | :---------------------: | :----------------------------------------------------------: | :------: |
|       type       | 整型，取值范围[0,1, 2]  | 0表示通知，算法无需做出动作选择；1为表示算法需要做出动作选择；2表示小局游戏结束，包含游戏结束信息 |    是    |
|    hand_cards    |      列表数据类型       |                          自己的手牌                          |    是    |
|      public      |      字典数据类型       | 场上的公共信息，包含各AI当前正在结算的牌型及各AI所剩余手牌数量 |    是    |
|  current_player  | 整型，取值范围[0,1,2,3] |                     当前出牌AI的座位次序                     |    是    |
|  current_stage   | 整型，取值范围[2, 5, 6] |       2表示游戏出牌阶段，5表示进贡阶段，6表示还贡阶段        |    是    |
|    self_rank     |         字符串          |                         己方当前等级                         |    是    |
|  opponent_rank   |         字符串          |                         对方当前等级                         |    是    |
|   action_list    |    字典数据类型/null    | 可选动作空间/合法动作空间；通知类型下action_list字段值为null（None） |    是    |
| action_performed |      字典数据类型       |              当前打出的牌型（即上家打出的牌型）              |    是    |
|  current_times   |          整型           |                         当前训练次数                         |    是    |
|  training_times  |          整型           |                          总训练次数                          |    是    |

+ 后续重复字段将不在赘述

##### 动作选择类型

+ AI收到动作选择类型的消息即表示需要做出动作回应

```json
{
    'type': 2, 
    'hand_cards': [[1, '2'], [0, '2'], [3, '3'], [0, '3'], [0, '3'], [1, '6'], 
                   [1, '8'], [1, '8'], [1, '10'], [2, '10'], [0, 'Q'], [3, 'Q'],
                   [0, 'A'], [0, 'A'], [3, '5'], [0, '5'], [0, 'JOKER']], 
    'index': 0, 
    'public': [
        {'rest': 17, 'play_area': []},
        {'rest': 18, 'play_area': []},
        {'rest': 7, 'play_area': [[0, '9'], [1, '9'], [1, '9'], [3, '4'], [2, '4']]}, 
        {'rest': 18, 'play_area': []}
    ], 
    'current_player': 0, 
    'current_stage': 2, 
    'self_rank': '5', 
    'opponent_rank': '4', 
    'current_rank': '5', 
    'action_list': {'PASS': {'PASS': [[[0, 'PASS']]]}}, 
    'action_performed': {
        'action': [[0, 'PASS']], 
        'type': 'PASS', 
        'rank': 'PASS'
    }, 
    'current_times': 1, 
    'training_times': 2
}
```

|    字段     |   数据类型   |                             描述                             | 是否必须 |
| :---------: | :----------: | :----------------------------------------------------------: | :------: |
| action_list | 字典数据类型 | 动作选择类型下action_list字段值表示为AI当前可选的合法动作集合 |    是    |

#### 结束类型

+ AI收到结束类型的消息不需要做出动作选择，该类型消息表示当前小局结束，可从中提取出完牌次序，双方当前所处的等级信息等

```
JSON
{
    'type': 0, 
    'self_rank': '2', 
    'opponent_rank': '4', 
    'current_rank': '4', 
    'current_times': 1, 
    'training_times': 2, 
    'winners': [3, 0, 1, 2]
}
```

|  字段   |   数据类型   |           描述           |     是否必须      |
| :-----: | :----------: | :----------------------: | :---------------: |
| winners | 列表数据结构 | 优先出完牌的AI的座位次序 | 是，且长度始终为4 |